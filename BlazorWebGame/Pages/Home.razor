@page "/"
@using BlazorWebGame.Services
@inject GameStateService GameState
@implements IDisposable

<PageTitle>主页</PageTitle>

<h1>你好, @GameState.Player.Name!</h1>

<p class="mt-4">当前金币数量: <strong>@GameState.Player.Gold</strong></p>

<button class="btn btn-primary" @onclick="ManualAddGold">
    <span class="oi oi-plus" aria-hidden="true"></span> 手动获得 10 金币
</button>

<button class="btn btn-secondary" @onclick="SaveGame">
    <span class="oi oi-save" aria-hidden="true"></span> 手动保存
</button>

@code {
    protected override void OnInitialized()
    {
        // 订阅状态变化事件，以便在金币变化时自动刷新UI
        GameState.OnStateChanged += StateHasChanged;
    }

    private void ManualAddGold()
    {
        //GameState.AddGold(10);
    }

    private async Task SaveGame()
    {
        await GameState.SaveStateAsync();
    }

    public void Dispose()
    {
        // 组件销毁时，取消订阅，防止内存泄漏
        GameState.OnStateChanged -= StateHasChanged;
    }
}