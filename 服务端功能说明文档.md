# BlazorWebGame æœåŠ¡ç«¯åŠŸèƒ½è¯´æ˜æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

BlazorWebGame æ˜¯ä¸€ä¸ªåŸºäº ASP.NET Core 8.0 çš„ç°ä»£åŒ–Webæ¸¸æˆåç«¯æœåŠ¡ï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼Œæä¾›äº†å®Œæ•´çš„MMORPGæ¸¸æˆåŠŸèƒ½æ”¯æŒã€‚

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: ASP.NET Core 8.0
- **å®æ—¶é€šä¿¡**: SignalR
- **èº«ä»½è®¤è¯**: JWT Bearer Token
- **æ—¥å¿—ç³»ç»Ÿ**: Serilog
- **APIæ–‡æ¡£**: Swagger/OpenAPI 3.0
- **ä¾èµ–æ³¨å…¥**: Microsoft.Extensions.DependencyInjection

## æ ¸å¿ƒæ¶æ„ç»„ä»¶

### 1. åº”ç”¨ç¨‹åºå…¥å£ (Program.cs)
**é…ç½®ç‰¹æ€§**ï¼š
- å®Œæ•´çš„ä¸­é—´ä»¶ç®¡é“é…ç½®
- JWTèº«ä»½éªŒè¯å’Œæˆæƒ
- CORSè·¨åŸŸèµ„æºå…±äº«é…ç½®
- é€Ÿç‡é™åˆ¶é˜²æŠ¤
- Serilogç»“æ„åŒ–æ—¥å¿—
- å¥åº·æ£€æŸ¥ç³»ç»Ÿ

**æœåŠ¡æ³¨å†Œæ¨¡å¼**ï¼š
```csharp
// å•ä¾‹æœåŠ¡ - æ¸¸æˆæ ¸å¿ƒç»„ä»¶
builder.Services.AddSingleton<GameEngineService>();
builder.Services.AddSingleton<UnifiedEventService>();

// åå°æœåŠ¡ - æŒç»­è¿è¡Œçš„ä»»åŠ¡
builder.Services.AddHostedService<GameLoopService>();
builder.Services.AddHostedService<ServerOptimizationService>();
```

### 2. ä¸­é—´ä»¶ç®¡é“æ¶æ„
æ‰§è¡Œé¡ºåºï¼ˆé‡è¦ï¼‰ï¼š
1. **HTTPSé‡å®šå‘** - å¼ºåˆ¶HTTPSè¿æ¥
2. **CORS** - è·¨åŸŸèµ„æºå…±äº«
3. **è¯·æ±‚æ—¥å¿—** - è®°å½•æ‰€æœ‰HTTPè¯·æ±‚
4. **é€Ÿç‡é™åˆ¶** - é˜²æ­¢APIæ»¥ç”¨
5. **é”™è¯¯å¤„ç†** - å…¨å±€å¼‚å¸¸æ•è·
6. **èº«ä»½è®¤è¯** - JWTä»¤ç‰ŒéªŒè¯
7. **æˆæƒ** - æƒé™æ£€æŸ¥

## APIæ¥å£è¯¦ç»†æ–‡æ¡£

### ğŸ” è®¤è¯æ¨¡å— (AuthController)

#### ç”¨æˆ·ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "string",
  "password": "string"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "string",
    "expiresAt": "2024-01-01T00:00:00Z",
    "userId": "string",
    "username": "string"
  },
  "message": "Login successful",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

#### ç”¨æˆ·æ³¨å†Œ
```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "string",
  "password": "string",
  "email": "string"
}
```

#### ä»¤ç‰Œåˆ·æ–°
```http
POST /api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "string"
}
```

#### ç”¨æˆ·ç™»å‡º
```http
POST /api/auth/logout
Authorization: Bearer {token}
```

### âš”ï¸ æˆ˜æ–—æ¨¡å— (BattleController)

#### å¼€å§‹æˆ˜æ–—
```http
POST /api/battle/start
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "enemyId": "string",
  "partyId": "string" // å¯é€‰
}
```

**å®‰å…¨éªŒè¯**:
- âœ… è§’è‰²å½’å±æƒéªŒè¯
- âœ… æ¸¸æˆçŠ¶æ€éªŒè¯  
- âœ… é˜Ÿä¼æƒé™éªŒè¯ï¼ˆå¦‚æœæ˜¯ç»„é˜Ÿæˆ˜æ–—ï¼‰

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "battleId": "guid",
    "characterId": "string",
    "enemyId": "string",
    "partyId": "string",
    "isActive": true,
    "playerHealth": 100,
    "playerMaxHealth": 100,
    "enemyHealth": 80,
    "enemyMaxHealth": 80,
    "lastUpdated": "2024-01-01T00:00:00Z",
    "battleType": "Normal",
    "partyMemberIds": ["string"],
    "players": [...],
    "enemies": [...],
    "status": "Active"
  }
}
```

#### è·å–æˆ˜æ–—çŠ¶æ€
```http
GET /api/battle/state/{battleId}
Authorization: Bearer {token}
```

#### æ‰§è¡Œæˆ˜æ–—åŠ¨ä½œ
```http
POST /api/battle/action
Authorization: Bearer {token}
Content-Type: application/json

{
  "battleId": "guid",
  "playerId": "string",
  "actionType": "Attack", // Attack, Skill, Item, Defend
  "targetId": "string",
  "skillId": "string" // å¯é€‰ï¼Œä½¿ç”¨æŠ€èƒ½æ—¶éœ€è¦
}
```

#### åœæ­¢æˆ˜æ–—
```http
POST /api/battle/stop/{battleId}
Authorization: Bearer {token}
```

#### è·å–æ´»è·ƒæˆ˜æ–—åˆ—è¡¨
```http
GET /api/battle/active
Authorization: Bearer {token}
```

### ğŸ‘¤ è§’è‰²ç®¡ç†æ¨¡å— (CharacterController)

#### è·å–è§’è‰²åˆ—è¡¨
```http
GET /api/character
Authorization: Bearer {token}
```

#### è·å–è§’è‰²è¯¦æƒ…
```http
GET /api/character/{characterId}
Authorization: Bearer {token}
```

#### åˆ›å»ºè§’è‰²
```http
POST /api/character
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "string",
  "characterClass": "Warrior", // Warrior, Mage, Archerç­‰
  "attributes": {
    "strength": 10,
    "intelligence": 10,
    "agility": 10
  }
}
```

#### æ›´æ–°è§’è‰²
```http
PUT /api/character/{characterId}
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "string",
  "attributes": {...}
}
```

### ğŸ‘¥ é˜Ÿä¼ç®¡ç†æ¨¡å— (PartyController)

#### åˆ›å»ºé˜Ÿä¼
```http
POST /api/party/create
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "string",
  "maxMembers": 5,
  "isPublic": true,
  "description": "string"
}
```

#### åŠ å…¥é˜Ÿä¼
```http
POST /api/party/join
Authorization: Bearer {token}
Content-Type: application/json

{
  "partyId": "string",
  "characterId": "string"
}
```

#### ç¦»å¼€é˜Ÿä¼
```http
POST /api/party/leave/{partyId}
Authorization: Bearer {token}
```

#### è·å–é˜Ÿä¼ä¿¡æ¯
```http
GET /api/party/{partyId}
Authorization: Bearer {token}
```

### ğŸ’ èƒŒåŒ…ç®¡ç†æ¨¡å— (InventoryController)

#### è·å–èƒŒåŒ…å†…å®¹
```http
GET /api/inventory/{characterId}
Authorization: Bearer {token}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "characterId": "string",
    "items": [
      {
        "itemId": "string",
        "name": "Health Potion",
        "quantity": 5,
        "rarity": "Common",
        "type": "Consumable",
        "description": "Restores 50 HP"
      }
    ],
    "capacity": 50,
    "usedSlots": 25
  }
}
```

#### ä½¿ç”¨ç‰©å“
```http
POST /api/inventory/use
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "itemId": "string",
  "quantity": 1
}
```

#### ä¸¢å¼ƒç‰©å“
```http
DELETE /api/inventory/item/{itemId}
Authorization: Bearer {token}
```

### âš”ï¸ è£…å¤‡ç®¡ç†æ¨¡å— (EquipmentController)

#### è£…å¤‡ç‰©å“
```http
POST /api/equipment/equip
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "itemId": "string",
  "slot": "MainHand" // MainHand, OffHand, Helmet, Armorç­‰
}
```

#### å¸ä¸‹è£…å¤‡
```http
POST /api/equipment/unequip
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "slot": "MainHand"
}
```

#### è·å–è£…å¤‡ä¿¡æ¯
```http
GET /api/equipment/{characterId}
Authorization: Bearer {token}
```

### ğŸ”¨ ç”Ÿäº§åˆ¶ä½œæ¨¡å— (ProductionController)

#### å¼€å§‹åˆ¶ä½œ
```http
POST /api/production/craft
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "recipeId": "string",
  "quantity": 1
}
```

#### è·å–åˆ¶ä½œçŠ¶æ€
```http
GET /api/production/status/{characterId}
Authorization: Bearer {token}
```

#### å­¦ä¹ é…æ–¹
```http
POST /api/production/learn-recipe
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "recipeId": "string"
}
```

### ğŸ“œ ä»»åŠ¡ç³»ç»Ÿæ¨¡å— (QuestController)

#### è·å–å¯æ¥ä»»åŠ¡
```http
GET /api/quest/available/{characterId}
Authorization: Bearer {token}
```

#### æ¥å—ä»»åŠ¡
```http
POST /api/quest/accept
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "questId": "string"
}
```

#### å®Œæˆä»»åŠ¡
```http
POST /api/quest/complete
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "questId": "string"
}
```

#### è·å–ä»»åŠ¡è¿›åº¦
```http
GET /api/quest/progress/{characterId}
Authorization: Bearer {token}
```

### ğŸ›’ å•†åº—ç³»ç»Ÿæ¨¡å— (ShopController)

#### è·å–å•†åº—ç‰©å“
```http
GET /api/shop/{shopId}/items
Authorization: Bearer {token}
```

#### è´­ä¹°ç‰©å“
```http
POST /api/shop/buy
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "shopId": "string",
  "itemId": "string",
  "quantity": 1
}
```

#### å‡ºå”®ç‰©å“
```http
POST /api/shop/sell
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "shopId": "string",
  "itemId": "string",
  "quantity": 1
}
```

### ğŸ† å£°æœ›ç³»ç»Ÿæ¨¡å— (ReputationController)

#### è·å–å£°æœ›ä¿¡æ¯
```http
GET /api/reputation/{characterId}
Authorization: Bearer {token}
```

#### æ›´æ–°å£°æœ›
```http
POST /api/reputation/update
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "factionId": "string",
  "reputationChange": 100
}
```

### ğŸ’¾ æ•°æ®å­˜å‚¨æ¨¡å— (DataStorageController)

#### ä¿å­˜æ¸¸æˆæ•°æ®
```http
POST /api/datastorage/save
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "gameData": {
    "position": {"x": 100, "y": 200},
    "questProgress": {...},
    "settings": {...}
  }
}
```

#### åŠ è½½æ¸¸æˆæ•°æ®
```http
GET /api/datastorage/load/{characterId}
Authorization: Bearer {token}
```

### ğŸŒ™ ç¦»çº¿ç»“ç®—æ¨¡å— (OfflineSettlementController)

#### è·å–ç¦»çº¿æ”¶ç›Š
```http
GET /api/offline/settlement/{characterId}
Authorization: Bearer {token}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "experienceGained": 1250,
    "goldGained": 500,
    "itemsGained": [
      {"itemId": "iron_ore", "quantity": 10}
    ],
    "offlineTime": "02:30:00",
    "activities": [
      {
        "activityType": "Mining",
        "duration": "02:30:00",
        "efficiency": 0.8
      }
    ]
  }
}
```

#### ç¡®è®¤ç¦»çº¿ç»“ç®—
```http
POST /api/offline/confirm
Authorization: Bearer {token}
Content-Type: application/json

{
  "characterId": "string",
  "settlementId": "string"
}
```

### ğŸ“Š ç›‘æ§æ¨¡å— (MonitoringController)

#### ç³»ç»Ÿå¥åº·çŠ¶æ€
```http
GET /api/monitoring/health
Authorization: Bearer {token}
```

#### æ€§èƒ½æŒ‡æ ‡
```http
GET /api/monitoring/metrics
Authorization: Bearer {token}
```

#### æ´»è·ƒç”¨æˆ·ç»Ÿè®¡
```http
GET /api/monitoring/active-users
Authorization: Bearer {token}
```

### ğŸ“– APIæ–‡æ¡£æ¨¡å— (ApiDocumentationController)

#### è·å–APIæ–‡æ¡£
```http
GET /api/documentation
```

## SignalR å®æ—¶é€šä¿¡ç³»ç»Ÿ

### GameHub è¿æ¥ç®¡ç†

SignalRæä¾›åŒå‘å®æ—¶é€šä¿¡ï¼Œæ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š

#### å®¢æˆ·ç«¯è°ƒç”¨çš„æ–¹æ³•

**åŠ å…¥æˆ˜æ–—ç¾¤ç»„**
```javascript
connection.invoke("JoinBattle", battleId);
```

**ç¦»å¼€æˆ˜æ–—ç¾¤ç»„**
```javascript
connection.invoke("LeaveBattle", battleId);
```

**åŠ å…¥é˜Ÿä¼ç¾¤ç»„**
```javascript
connection.invoke("JoinParty", partyId);
```

**ç¦»å¼€é˜Ÿä¼ç¾¤ç»„**
```javascript
connection.invoke("LeaveParty", partyId);
```

**è®¢é˜…è§’è‰²æ›´æ–°**
```javascript
connection.invoke("JoinCharacterUpdates", characterId);
```

**å–æ¶ˆè§’è‰²æ›´æ–°è®¢é˜…**
```javascript
connection.invoke("LeaveCharacterUpdates", characterId);
```

#### æœåŠ¡ç«¯æ¨é€çš„äº‹ä»¶

**æˆ˜æ–—çŠ¶æ€æ›´æ–°**
```javascript
connection.on("BattleUpdate", function (battleState) {
    // å¤„ç†æˆ˜æ–—çŠ¶æ€æ›´æ–°
    console.log("Battle updated:", battleState);
});
```

**é˜Ÿä¼çŠ¶æ€æ›´æ–°**
```javascript
connection.on("PartyUpdate", function (partyState) {
    // å¤„ç†é˜Ÿä¼çŠ¶æ€æ›´æ–°
    console.log("Party updated:", partyState);
});
```

**è§’è‰²çŠ¶æ€æ›´æ–°**
```javascript
connection.on("CharacterUpdate", function (character) {
    // å¤„ç†è§’è‰²çŠ¶æ€æ›´æ–°
    console.log("Character updated:", character);
});
```

**ç³»ç»Ÿé€šçŸ¥**
```javascript
connection.on("Notification", function (notification) {
    // å¤„ç†ç³»ç»Ÿé€šçŸ¥
    console.log("Notification:", notification.message);
});
```

### è¿æ¥ç®¡ç†

**å»ºç«‹è¿æ¥**
```javascript
const connection = new signalR.HubConnectionBuilder()
    .withUrl("/gamehub", {
        accessTokenFactory: () => localStorage.getItem("accessToken")
    })
    .withAutomaticReconnect()
    .build();

await connection.start();
```

**è¿æ¥çŠ¶æ€ç›‘å¬**
```javascript
connection.onclose(async () => {
    console.log("Connection closed");
    // é‡è¿é€»è¾‘
});

connection.onreconnected(() => {
    console.log("Reconnected");
});
```

## æ ¸å¿ƒæœåŠ¡æ¶æ„è¯¦è§£

### ğŸ® æ¸¸æˆå¼•æ“æœåŠ¡ (GameEngineService)

**æ ¸å¿ƒèŒè´£**ï¼š
- æˆ˜æ–—é€»è¾‘å¤„ç†
- æ¸¸æˆçŠ¶æ€ç®¡ç†
- äº‹ä»¶è§¦å‘å’Œå¤„ç†
- å®æ—¶çŠ¶æ€åŒæ­¥

**å…³é”®ç‰¹æ€§**ï¼š
- å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€å”¯ä¸€å®ä¾‹
- çº¿ç¨‹å®‰å…¨çš„å¹¶å‘å¤„ç†
- åŸºäºäº‹ä»¶é©±åŠ¨çš„æ¶æ„
- æ”¯æŒç»„é˜Ÿæˆ˜æ–—

**ä¸»è¦æ–¹æ³•**ï¼š
```csharp
public BattleStateDto StartBattle(StartBattleRequest request)
public BattleStateDto? GetBattleState(Guid battleId)
public bool ExecuteBattleAction(BattleActionRequest request)
public bool StopBattle(Guid battleId)
public void ProcessBattleTick(double deltaTime)
```

### â° æ¸¸æˆå¾ªç¯æœåŠ¡ (GameLoopService)

**æ ¸å¿ƒèŒè´£**ï¼š
- åå°æŒç»­è¿è¡Œçš„æ¸¸æˆé€»è¾‘å¤„ç†
- å®šæ—¶æ›´æ–°æ¸¸æˆçŠ¶æ€
- æˆ˜æ–—tickå¤„ç†
- å®¢æˆ·ç«¯çŠ¶æ€åŒæ­¥

**è¿è¡Œç‰¹æ€§**ï¼š
- åå°æœåŠ¡ï¼ˆHostedServiceï¼‰
- 500msæ‰§è¡Œé—´éš”
- å¼‚å¸¸æ¢å¤æœºåˆ¶
- æ€§èƒ½ç›‘æ§

**å¤„ç†æµç¨‹**ï¼š
```csharp
// æ¯500msæ‰§è¡Œä¸€æ¬¡
while (await timer.WaitForNextTickAsync(stoppingToken))
{
    var deltaTime = CalculateDeltaTime();
    _gameEngine.ProcessBattleTick(deltaTime);
    await NotifyClients();
}
```

### ğŸ”„ ç»Ÿä¸€äº‹ä»¶æœåŠ¡ (UnifiedEventService)

**æ ¸å¿ƒèŒè´£**ï¼š
- æ¸¸æˆäº‹ä»¶çš„é˜Ÿåˆ—ç®¡ç†
- äº‹ä»¶ä¼˜å…ˆçº§å¤„ç†
- äº‹ä»¶æŒä¹…åŒ–
- è·¨æœåŠ¡äº‹ä»¶é€šä¿¡

**äº‹ä»¶ç±»å‹**ï¼š
- æˆ˜æ–—ç›¸å…³äº‹ä»¶
- è§’è‰²çŠ¶æ€å˜åŒ–äº‹ä»¶  
- é˜Ÿä¼ç®¡ç†äº‹ä»¶
- ç³»ç»Ÿé€šçŸ¥äº‹ä»¶

**äº‹ä»¶å¤„ç†æµç¨‹**ï¼š
```csharp
// äº‹ä»¶å…¥é˜Ÿ
_eventService.EnqueueBattleEvent(GameEventTypes.BATTLE_STARTED, battleId, characterId);

// äº‹ä»¶å¤„ç†
await _eventService.ProcessEvents();
```

### ğŸ”§ æœåŠ¡å®šä½å™¨ (ServerServiceLocator)

**æ ¸å¿ƒèŒè´£**ï¼š
- å…¨å±€æœåŠ¡å®ä¾‹ç®¡ç†
- æœåŠ¡ç”Ÿå‘½å‘¨æœŸæ§åˆ¶
- ä¾èµ–æ³¨å…¥è¡¥å……
- é™æ€æœåŠ¡è®¿é—®

**ä½¿ç”¨æ¨¡å¼**ï¼š
```csharp
// åˆå§‹åŒ–ï¼ˆåœ¨Program.csä¸­ï¼‰
ServerServiceLocator.Initialize(app.Services);

// è·å–æœåŠ¡å®ä¾‹
var gameEngine = ServerServiceLocator.GetService<GameEngineService>();
```

### ğŸ” å®‰å…¨è®¤è¯æœåŠ¡ (GameAuthenticationService)

**æ ¸å¿ƒèŒè´£**ï¼š
- JWTä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯
- ç”¨æˆ·èº«ä»½è®¤è¯
- ä»¤ç‰Œåˆ·æ–°ç®¡ç†
- å®‰å…¨ç­–ç•¥å®æ–½

**å®‰å…¨ç‰¹æ€§**ï¼š
- HMAC-SHA256ç­¾åç®—æ³•
- å¯é…ç½®çš„ä»¤ç‰Œè¿‡æœŸæ—¶é—´
- é˜²é‡æ”¾æ”»å‡»æœºåˆ¶
- å®‰å…¨çš„å¯†é’¥ç®¡ç†

**ä»¤ç‰Œç»“æ„**ï¼š
```json
{
  "sub": "userId",
  "username": "playerName",
  "iat": 1640995200,
  "exp": 1640998800,
  "iss": "BlazorWebGame",
  "aud": "BlazorWebGame.Client"
}
```

### ğŸ’¾ æ•°æ®å­˜å‚¨æœåŠ¡ (DataStorageService)

**æ ¸å¿ƒèŒè´£**ï¼š
- è§’è‰²æ•°æ®æŒä¹…åŒ–
- æ¸¸æˆè¿›åº¦ä¿å­˜
- èƒŒåŒ…å’Œè£…å¤‡ç®¡ç†
- æ•°æ®ç‰ˆæœ¬æ§åˆ¶

**å­˜å‚¨æ¨¡å¼**ï¼š
- å¼€å‘ç¯å¢ƒï¼šå†…å­˜å­˜å‚¨
- ç”Ÿäº§ç¯å¢ƒï¼šæ•°æ®åº“å­˜å‚¨ï¼ˆå¯é…ç½®ï¼‰
- å¼‚æ­¥æ“ä½œæ”¯æŒ
- æ•°æ®å‹ç¼©å’Œåºåˆ—åŒ–

**æ•°æ®ç»“æ„**ï¼š
```csharp
public class GameData
{
    public string CharacterId { get; set; }
    public DateTime LastSaved { get; set; }
    public Dictionary<string, object> Properties { get; set; }
    public int Version { get; set; }
}
```

### ğŸ“ˆ æ€§èƒ½ç›‘æ§æœåŠ¡ (PerformanceMonitoringService)

**æ ¸å¿ƒèŒè´£**ï¼š
- ç³»ç»Ÿæ€§èƒ½å®æ—¶ç›‘æ§
- å†…å­˜ä½¿ç”¨ç»Ÿè®¡
- APIå“åº”æ—¶é—´ç›‘æ§
- é”™è¯¯ç‡ç»Ÿè®¡åˆ†æ

**ç›‘æ§æŒ‡æ ‡**ï¼š
- CPUä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨é‡
- æ´»è·ƒè¿æ¥æ•°
- è¯·æ±‚å“åº”æ—¶é—´
- é”™è¯¯å‘ç”Ÿç‡

**æŠ¥å‘Šç”Ÿæˆ**ï¼š
```csharp
public class PerformanceReport
{
    public double CpuUsage { get; set; }
    public long MemoryUsage { get; set; }
    public int ActiveConnections { get; set; }
    public double AverageResponseTime { get; set; }
    public double ErrorRate { get; set; }
    public DateTime Timestamp { get; set; }
}
```

## å®‰å…¨æœºåˆ¶è¯¦è§£

### ğŸ›¡ï¸ èº«ä»½è®¤è¯ç³»ç»Ÿ

**JWTé…ç½®**ï¼š
```csharp
services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =>
    {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true,
            ValidateAudience = true,
            ValidateLifetime = true,
            ValidateIssuerSigningKey = true,
            ValidIssuer = "BlazorWebGame",
            ValidAudience = "BlazorWebGame.Client",
            IssuerSigningKey = new SymmetricSecurityKey(key),
            ClockSkew = TimeSpan.FromMinutes(1)
        };
    });
```

**SignalRè®¤è¯**ï¼š
```csharp
// æ”¯æŒé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’Token
options.Events = new JwtBearerEvents
{
    OnMessageReceived = context =>
    {
        var accessToken = context.Request.Query["access_token"];
        var path = context.HttpContext.Request.Path;
        
        if (!string.IsNullOrEmpty(accessToken) && 
            path.StartsWithSegments("/gamehub"))
        {
            context.Token = accessToken;
        }
        return Task.CompletedTask;
    }
};
```

### ğŸ”’ èµ„æºæƒé™éªŒè¯

**è‡ªå®šä¹‰éªŒè¯å±æ€§**ï¼š
```csharp
[ValidateResourceOwnership("CharacterId", ResourceType.Character)]
[ValidateGameState(GameStateValidationType.BattleCanStart)]
public ActionResult<ApiResponse<BattleStateDto>> StartBattle(StartBattleRequest request)
```

**éªŒè¯ç±»å‹**ï¼š
- `ResourceType.Character`: è§’è‰²å½’å±éªŒè¯
- `ResourceType.Battle`: æˆ˜æ–—å‚ä¸æƒéªŒè¯
- `ResourceType.Party`: é˜Ÿä¼æˆå‘˜æƒé™éªŒè¯

**éªŒè¯æµç¨‹**ï¼š
1. æå–ç”¨æˆ·IDä»JWTä»¤ç‰Œ
2. æ£€æŸ¥èµ„æºå½’å±å…³ç³»
3. éªŒè¯æ“ä½œæƒé™
4. è®°å½•å®‰å…¨äº‹ä»¶æ—¥å¿—

### ğŸš¦ é€Ÿç‡é™åˆ¶ç³»ç»Ÿ

**é™åˆ¶è§„åˆ™**ï¼š
```csharp
public class RateLimitOptions
{
    public RateLimitRule IpRateLimit { get; set; } = new()
    {
        MaxRequests = 100,
        TimeWindow = TimeSpan.FromMinutes(1)
    };
    
    public RateLimitRule UserRateLimit { get; set; } = new()
    {
        MaxRequests = 200,
        TimeWindow = TimeSpan.FromMinutes(1)
    };
}
```

**å®ç°åŸç†**ï¼š
- æ»‘åŠ¨çª—å£ç®—æ³•
- å†…å­˜å­˜å‚¨è®¡æ•°å™¨
- IPå’Œç”¨æˆ·åŒé‡é™åˆ¶
- è¶…é™è‡ªåŠ¨é˜»æ–­

### ğŸŒ CORSè·¨åŸŸé…ç½®

**å®‰å…¨ç­–ç•¥**ï¼š
```csharp
builder.Services.AddCors(options =>
{
    options.AddDefaultPolicy(policy =>
    {
        policy.WithOrigins(allowedOrigins)  // é…ç½®æ–‡ä»¶æŒ‡å®š
              .AllowAnyHeader()
              .AllowAnyMethod()
              .AllowCredentials();            // æ”¯æŒè®¤è¯Cookie
    });
});
```

**é…ç½®è¦ç‚¹**ï¼š
- æ˜ç¡®æŒ‡å®šå…è®¸çš„æ¥æºåŸŸå
- æ”¯æŒæ‰€æœ‰HTTPæ–¹æ³•
- å…è®¸æ‰€æœ‰è¯·æ±‚å¤´
- å¯ç”¨å‡­æ®ä¼ é€’

### âš ï¸ é”™è¯¯å¤„ç†æœºåˆ¶

**å…¨å±€å¼‚å¸¸å¤„ç†**ï¼š
```csharp
public class ErrorHandlingMiddleware
{
    public async Task InvokeAsync(HttpContext context, RequestDelegate next)
    {
        try
        {
            await next(context);
        }
        catch (Exception ex)
        {
            await HandleExceptionAsync(context, ex);
        }
    }
}
```

**é”™è¯¯å“åº”æ ¼å¼**ï¼š
```json
{
  "success": false,
  "message": "User-friendly error message",
  "errors": ["Detailed error info"],
  "timestamp": "2024-01-01T00:00:00Z"
}
```

**å®‰å…¨è€ƒé‡**ï¼š
- ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯
- è¯¦ç»†é”™è¯¯ä»…è®°å½•åˆ°æ—¥å¿—
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- å¼‚å¸¸å †æ ˆè·Ÿè¸ªä¿æŠ¤

## æ•°æ®ä¼ è¾“å¯¹è±¡ (DTOs) è¯¦è§£

### ğŸ“Š ç»Ÿä¸€å“åº”æ ¼å¼

**ApiResponse<T>**ï¼š
```csharp
public class ApiResponse<T>
{
    public bool Success { get; set; }           // æ“ä½œæ˜¯å¦æˆåŠŸ
    public string Message { get; set; }         // ç”¨æˆ·å‹å¥½æ¶ˆæ¯
    public T? Data { get; set; }               // å®é™…æ•°æ®è´Ÿè½½
    public List<string> Errors { get; set; }   // é”™è¯¯è¯¦æƒ…åˆ—è¡¨
    public DateTime Timestamp { get; set; }    // å“åº”æ—¶é—´æˆ³
}
```

### âš”ï¸ æˆ˜æ–—ç›¸å…³DTOs

**BattleStateDto - æˆ˜æ–—çŠ¶æ€**ï¼š
```csharp
public class BattleStateDto
{
    public Guid BattleId { get; set; }              // æˆ˜æ–—å”¯ä¸€æ ‡è¯†
    public string CharacterId { get; set; }         // ä¸»è§’è‰²ID
    public string EnemyId { get; set; }             // æ•ŒäººID
    public string? PartyId { get; set; }            // é˜Ÿä¼IDï¼ˆå¯é€‰ï¼‰
    public bool IsActive { get; set; }              // æˆ˜æ–—æ˜¯å¦æ´»è·ƒ
    public int PlayerHealth { get; set; }           // ç©å®¶ç”Ÿå‘½å€¼
    public int PlayerMaxHealth { get; set; }        // ç©å®¶æœ€å¤§ç”Ÿå‘½å€¼
    public int EnemyHealth { get; set; }            // æ•Œäººç”Ÿå‘½å€¼
    public int EnemyMaxHealth { get; set; }         // æ•Œäººæœ€å¤§ç”Ÿå‘½å€¼
    public DateTime LastUpdated { get; set; }       // æœ€åæ›´æ–°æ—¶é—´
    public BattleType BattleType { get; set; }      // æˆ˜æ–—ç±»å‹
    public List<string> PartyMemberIds { get; set; } // é˜Ÿä¼æˆå‘˜åˆ—è¡¨
    
    // æ‰©å±•æˆ˜æ–—ä¿¡æ¯
    public List<BattleParticipantDto> Players { get; set; }     // ç©å®¶å‚ä¸è€…
    public List<BattleParticipantDto> Enemies { get; set; }     // æ•Œäººå‚ä¸è€…
    public BattleStatus Status { get; set; }                    // æˆ˜æ–—çŠ¶æ€
    public Dictionary<string, string> PlayerTargets { get; set; } // ç›®æ ‡æ˜ å°„
    public List<BattleActionDto> RecentActions { get; set; }    // æœ€è¿‘åŠ¨ä½œ
    public BattleResultDto? Result { get; set; }               // æˆ˜æ–—ç»“æœ
}
```

**BattleParticipantDto - æˆ˜æ–—å‚ä¸è€…**ï¼š
```csharp
public class BattleParticipantDto
{
    public string Id { get; set; }                    // å‚ä¸è€…ID
    public string Name { get; set; }                  // æ˜¾ç¤ºåç§°
    public int Health { get; set; }                   // å½“å‰ç”Ÿå‘½å€¼
    public int MaxHealth { get; set; }                // æœ€å¤§ç”Ÿå‘½å€¼
    public int AttackPower { get; set; }              // æ”»å‡»åŠ›
    public double AttacksPerSecond { get; set; }      // æ”»å‡»é€Ÿåº¦
    public double AttackCooldown { get; set; }        // æ”»å‡»å†·å´æ—¶é—´
    public List<string> EquippedSkills { get; set; }  // è£…å¤‡çš„æŠ€èƒ½
    public Dictionary<string, double> SkillCooldowns { get; set; } // æŠ€èƒ½å†·å´
    public bool IsPlayer { get; set; }                // æ˜¯å¦ä¸ºç©å®¶
}
```

### ğŸ‘¤ è§’è‰²ç›¸å…³DTOs

**CharacterDto - è§’è‰²ä¿¡æ¯**ï¼š
```csharp
public class CharacterDto
{
    public string Id { get; set; }                    // è§’è‰²ID
    public string Name { get; set; }                  // è§’è‰²åç§°
    public string UserId { get; set; }                // æ‰€å±ç”¨æˆ·ID
    public CharacterClass Class { get; set; }         // è§’è‰²èŒä¸š
    public int Level { get; set; }                    // ç­‰çº§
    public long Experience { get; set; }              // ç»éªŒå€¼
    public CharacterStats Stats { get; set; }         // å±æ€§ç»Ÿè®¡
    public EquipmentSetDto Equipment { get; set; }    // è£…å¤‡ä¿¡æ¯
    public InventoryDto Inventory { get; set; }       // èƒŒåŒ…ä¿¡æ¯
    public List<string> LearnedSkills { get; set; }   // å·²å­¦æŠ€èƒ½
    public Dictionary<string, int> Reputation { get; set; } // å£°æœ›å€¼
    public Vector3 Position { get; set; }             // ä½ç½®åæ ‡
    public DateTime LastLogin { get; set; }           // æœ€åç™»å½•æ—¶é—´
    public DateTime CreatedAt { get; set; }           // åˆ›å»ºæ—¶é—´
}
```

### ğŸ‘¥ é˜Ÿä¼ç›¸å…³DTOs

**PartyDto - é˜Ÿä¼ä¿¡æ¯**ï¼š
```csharp
public class PartyDto
{
    public string Id { get; set; }                    // é˜Ÿä¼ID
    public string Name { get; set; }                  // é˜Ÿä¼åç§°
    public string LeaderId { get; set; }              // é˜Ÿé•¿ID
    public List<PartyMemberDto> Members { get; set; } // é˜Ÿä¼æˆå‘˜
    public int MaxMembers { get; set; }               // æœ€å¤§æˆå‘˜æ•°
    public bool IsPublic { get; set; }                // æ˜¯å¦å…¬å¼€
    public string Description { get; set; }           // é˜Ÿä¼æè¿°
    public PartyStatus Status { get; set; }           // é˜Ÿä¼çŠ¶æ€
    public DateTime CreatedAt { get; set; }           // åˆ›å»ºæ—¶é—´
}
```

### ğŸ’ èƒŒåŒ…ç›¸å…³DTOs

**InventoryDto - èƒŒåŒ…ä¿¡æ¯**ï¼š
```csharp
public class InventoryDto
{
    public string CharacterId { get; set; }           // è§’è‰²ID
    public List<ItemStackDto> Items { get; set; }     // ç‰©å“å †æ ˆ
    public int Capacity { get; set; }                 // èƒŒåŒ…å®¹é‡
    public int UsedSlots { get; set; }                // å·²ä½¿ç”¨æ§½ä½
    public Dictionary<string, int> ItemCounts { get; set; } // ç‰©å“æ•°é‡ç»Ÿè®¡
}
```

**ItemStackDto - ç‰©å“å †æ ˆ**ï¼š
```csharp
public class ItemStackDto
{
    public string ItemId { get; set; }                // ç‰©å“ID
    public string Name { get; set; }                  // ç‰©å“åç§°
    public int Quantity { get; set; }                 // æ•°é‡
    public ItemRarity Rarity { get; set; }            // ç¨€æœ‰åº¦
    public ItemType Type { get; set; }                // ç‰©å“ç±»å‹
    public string Description { get; set; }           // ç‰©å“æè¿°
    public Dictionary<string, object> Properties { get; set; } // ç‰©å“å±æ€§
    public bool IsStackable { get; set; }             // æ˜¯å¦å¯å †å 
    public int SlotPosition { get; set; }             // æ§½ä½ä½ç½®
}
```

## é…ç½®ç³»ç»Ÿè¯¦è§£

### âš™ï¸ é…ç½®é€‰é¡¹ç±»

**GameServerOptions - æ¸¸æˆæœåŠ¡å™¨é…ç½®**ï¼š
```csharp
public class GameServerOptions
{
    public const string SectionName = "GameServer";
    
    [Required]
    public string ServerName { get; set; } = "BlazorWebGame Server";
    
    [Range(1, 65535)]
    public int Port { get; set; } = 5000;
    
    public bool EnableDevelopmentTests { get; set; } = false;
    
    [Range(100, 5000)]
    public int GameLoopIntervalMs { get; set; } = 500;
    
    public bool EnablePerformanceMonitoring { get; set; } = true;
    
    [Range(1, 1000)]
    public int MaxConcurrentBattles { get; set; } = 100;
}
```

**SecurityOptions - å®‰å…¨é…ç½®**ï¼š
```csharp
public class SecurityOptions
{
    public const string SectionName = "Security";
    
    public JwtOptions Jwt { get; set; } = new();
    public CorsOptions Cors { get; set; } = new();
    public RateLimitOptions RateLimit { get; set; } = new();
    
    public class JwtOptions
    {
        [Required]
        public string Key { get; set; } = string.Empty;
        
        [Required]
        public string Issuer { get; set; } = "BlazorWebGame";
        
        [Required]
        public string Audience { get; set; } = "BlazorWebGame.Client";
        
        [Range(1, 1440)]
        public int ExpirationMinutes { get; set; } = 15;
        
        [Range(1, 43200)]
        public int RefreshTokenExpirationMinutes { get; set; } = 10080; // 7 days
    }
}
```

**MonitoringOptions - ç›‘æ§é…ç½®**ï¼š
```csharp
public class MonitoringOptions
{
    public const string SectionName = "Monitoring";
    
    public bool EnableHealthChecks { get; set; } = true;
    public bool EnableMetricsCollection { get; set; } = true;
    public bool EnablePerformanceCounters { get; set; } = true;
    
    [Range(1, 300)]
    public int HealthCheckIntervalSeconds { get; set; } = 30;
    
    [Range(1, 3600)]
    public int MetricsCollectionIntervalSeconds { get; set; } = 60;
    
    public List<string> AlertEmailAddresses { get; set; } = new();
}
```

### ğŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹

**appsettings.json**ï¼š
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "BlazorWebGame": "Debug"
    }
  },
  
  "GameServer": {
    "ServerName": "BlazorWebGame Development Server",
    "Port": 5000,
    "EnableDevelopmentTests": true,
    "GameLoopIntervalMs": 500,
    "EnablePerformanceMonitoring": true,
    "MaxConcurrentBattles": 50
  },
  
  "Security": {
    "Jwt": {
      "Key": "your-super-secret-jwt-key-here-must-be-at-least-32-characters",
      "Issuer": "BlazorWebGame",
      "Audience": "BlazorWebGame.Client",
      "ExpirationMinutes": 15,
      "RefreshTokenExpirationMinutes": 10080
    },
    "Cors": {
      "AllowedOrigins": [
        "https://localhost:7051",
        "http://localhost:5190"
      ]
    },
    "RateLimit": {
      "IpRateLimit": {
        "MaxRequests": 100,
        "TimeWindowMinutes": 1
      },
      "UserRateLimit": {
        "MaxRequests": 200,
        "TimeWindowMinutes": 1
      }
    }
  },
  
  "Monitoring": {
    "EnableHealthChecks": true,
    "EnableMetricsCollection": true,
    "EnablePerformanceCounters": true,
    "HealthCheckIntervalSeconds": 30,
    "MetricsCollectionIntervalSeconds": 60,
    "AlertEmailAddresses": [
      "admin@blazorwebgame.com"
    ]
  },
  
  "Serilog": {
    "Using": ["Serilog.Sinks.Console", "Serilog.Sinks.File"],
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "outputTemplate": "[{Timestamp:HH:mm:ss} {Level:u3}] [{SourceContext}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "logs/blazorwebgame-.log",
          "rollingInterval": "Day",
          "outputTemplate": "[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} {Level:u3}] [{SourceContext}] {Message:lj}{NewLine}{Exception}"
        }
      }
    ]
  }
}
```

### ğŸ”§ é…ç½®éªŒè¯

**å¯åŠ¨æ—¶éªŒè¯**ï¼š
```csharp
// ç»‘å®šé…ç½®å¹¶éªŒè¯
builder.Services.AddOptions<GameServerOptions>()
    .Bind(builder.Configuration.GetSection(GameServerOptions.SectionName))
    .ValidateDataAnnotations()        // éªŒè¯æ•°æ®æ³¨è§£
    .ValidateOnStart();              // å¯åŠ¨æ—¶éªŒè¯

// è‡ªå®šä¹‰éªŒè¯
builder.Services.AddOptions<SecurityOptions>()
    .Bind(builder.Configuration.GetSection(SecurityOptions.SectionName))
    .Validate(options => 
    {
        // è‡ªå®šä¹‰éªŒè¯é€»è¾‘
        return options.Jwt.Key.Length >= 32;
    }, "JWT Key must be at least 32 characters long")
    .ValidateOnStart();
```

## å¥åº·æ£€æŸ¥ç³»ç»Ÿ

### ğŸ¥ å¥åº·æ£€æŸ¥é…ç½®

**æ³¨å†Œå¥åº·æ£€æŸ¥**ï¼š
```csharp
builder.Services.AddHealthChecks()
    .AddCheck<GameHealthCheckService>("game-health")
    .AddDbContextCheck<GameDbContext>()      // æ•°æ®åº“æ£€æŸ¥ï¼ˆå¦‚æœé…ç½®ï¼‰
    .AddRedisCheck("redis-connection");      // Redisæ£€æŸ¥ï¼ˆå¦‚æœé…ç½®ï¼‰
```

**è‡ªå®šä¹‰å¥åº·æ£€æŸ¥**ï¼š
```csharp
public class GameHealthCheckService : IHealthCheck
{
    private readonly GameEngineService _gameEngine;
    private readonly PerformanceMonitoringService _performanceService;

    public async Task<HealthCheckResult> CheckHealthAsync(
        HealthCheckContext context,
        CancellationToken cancellationToken = default)
    {
        try
        {
            var activeBattles = _gameEngine.GetActiveBattleCount();
            var memoryUsage = _performanceService.GetMemoryUsage();
            var uptime = _performanceService.GetUptime();

            var data = new Dictionary<string, object>
            {
                ["active_battles"] = activeBattles,
                ["memory_usage_mb"] = memoryUsage / 1024 / 1024,
                ["uptime"] = uptime.ToString(@"dd\.hh\:mm\:ss"),
                ["status"] = "All systems operational"
            };

            // å¥åº·çŠ¶æ€åˆ¤æ–­
            if (activeBattles > 90 || memoryUsage > 1000 * 1024 * 1024) // 90åœºæˆ˜æ–—æˆ–1GBå†…å­˜
            {
                return HealthCheckResult.Degraded("System under high load", null, data);
            }

            return HealthCheckResult.Healthy("Game engine is running normally", data);
        }
        catch (Exception ex)
        {
            return HealthCheckResult.Unhealthy("Game engine error", ex);
        }
    }
}
```

### ğŸ“Š å¥åº·æ£€æŸ¥ç«¯ç‚¹

**è¯¦ç»†å¥åº·æŠ¥å‘Š** - `/health`:
```json
{
  "Status": "Healthy",
  "Checks": [
    {
      "Name": "game-health",
      "Status": "Healthy",
      "Description": "Game engine is running normally",
      "Data": {
        "active_battles": 15,
        "memory_usage_mb": 256,
        "uptime": "01.05:30:45",
        "status": "All systems operational"
      }
    }
  ],
  "Duration": 125.7
}
```

**ç®€å•å¥åº·çŠ¶æ€** - `/health/simple`:
```json
{
  "Status": "Healthy",
  "Timestamp": "2024-01-01T12:00:00Z",
  "Environment": "Development"
}
```

**APIä¿¡æ¯** - `/api/info`:
```json
{
  "Name": "BlazorWebGame Server API",
  "Version": "1.0.0",
  "Environment": "Development",
  "Timestamp": "2024-01-01T12:00:00Z"
}
```

## æ—¥å¿—ç³»ç»Ÿè¯¦è§£

### ğŸ“ æ—¥å¿—é…ç½®

**Serilogé…ç½®**ï¼š
```csharp
Log.Logger = new LoggerConfiguration()
    .ReadFrom.Configuration(builder.Configuration)
    .Enrich.FromLogContext()
    .WriteTo.Console(outputTemplate: "[{Timestamp:HH:mm:ss} {Level:u3}] [{SourceContext}] {Message:lj}{NewLine}{Exception}")
    .WriteTo.File("logs/blazorwebgame-.log", 
        rollingInterval: RollingInterval.Day,
        outputTemplate: "[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} {Level:u3}] [{SourceContext}] {Message:lj}{NewLine}{Exception}")
    .CreateLogger();
```

### ğŸ“Š æ—¥å¿—çº§åˆ«å’Œå†…å®¹

**Debugçº§åˆ«** - è°ƒè¯•ä¿¡æ¯ï¼š
```csharp
_logger.LogDebug("Battle action executed for user {UserId} in battle {BattleId}", userId, battleId);
```

**Informationçº§åˆ«** - ä¸€èˆ¬ä¿¡æ¯ï¼š
```csharp
_logger.LogInformation("Battle {BattleId} started by user {UserId}", battleId, userId);
```

**Warningçº§åˆ«** - è­¦å‘Šä¿¡æ¯ï¼š
```csharp
_logger.LogWarning("Invalid battle start request from user {UserId}: missing required fields", userId);
```

**Errorçº§åˆ«** - é”™è¯¯ä¿¡æ¯ï¼š
```csharp
_logger.LogError(ex, "Error starting battle for user {UserId}", userId);
```

**Fatalçº§åˆ«** - è‡´å‘½é”™è¯¯ï¼š
```csharp
Log.Fatal(ex, "Application terminated unexpectedly");
```

### ğŸ” ç»“æ„åŒ–æ—¥å¿—

**å®‰å…¨äº‹ä»¶æ—¥å¿—**ï¼š
```csharp
_logger.LogWarning("Unauthorized access attempt: User {UserId} tried to access character {CharacterId} from IP {ClientIp}", 
    userId, characterId, clientIp);
```

**æ€§èƒ½ç›‘æ§æ—¥å¿—**ï¼š
```csharp
_logger.LogInformation("Performance metrics: CPU {CpuUsage}%, Memory {MemoryUsage}MB, Active battles {ActiveBattles}", 
    cpuUsage, memoryUsage, activeBattles);
```

**ä¸šåŠ¡æµç¨‹æ—¥å¿—**ï¼š
```csharp
_logger.LogInformation("Character {CharacterId} leveled up from {OldLevel} to {NewLevel}, gained {ExperienceGained} XP", 
    characterId, oldLevel, newLevel, experienceGained);
```

## å¼€å‘å·¥å…·å’Œè°ƒè¯•

### ğŸ”§ Swagger/OpenAPIæ–‡æ¡£

**é…ç½®**ï¼š
```csharp
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI(c =>
    {
        c.SwaggerEndpoint("/swagger/v1/swagger.json", "BlazorWebGame API V1");
        c.RoutePrefix = "swagger";
        c.DefaultModelExpandDepth(2);
        c.DefaultModelRendering(ModelRendering.Model);
        c.DocExpansion(DocExpansion.List);
        c.EnableDeepLinking();
        c.DisplayOperationId();
    });
}
```

**è®¿é—®åœ°å€**ï¼š
- Swagger UI: `https://localhost:5001/swagger`
- OpenAPIè§„èŒƒ: `https://localhost:5001/swagger/v1/swagger.json`

### ğŸ§ª å¼€å‘ç¯å¢ƒæµ‹è¯•

**è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼š
```csharp
if (app.Environment.IsDevelopment() && gameServerOptions.EnableDevelopmentTests)
{
    // æˆ˜æ–—ç³»ç»Ÿæµ‹è¯•
    TestBattleSystem.RunBattleTest(app.Services, logger);
    
    // é˜Ÿä¼ç³»ç»Ÿæµ‹è¯•
    TestPartySystem.RunPartyTest(logger);
    
    // äº‹ä»¶ç³»ç»Ÿæµ‹è¯•
    UnifiedEventSystemTest.RunEventSystemTest(app.Services, logger);
    UnifiedEventSystemTest.RunPerformanceBenchmark(logger);
}
```

**æµ‹è¯•å†…å®¹**ï¼š
- æˆ˜æ–—ç³»ç»Ÿå®Œæ•´æµç¨‹æµ‹è¯•
- é˜Ÿä¼åˆ›å»ºå’Œç®¡ç†æµ‹è¯•
- äº‹ä»¶ç³»ç»Ÿæ€§èƒ½åŸºå‡†æµ‹è¯•
- SignalRè¿æ¥å’Œæ¶ˆæ¯ä¼ é€’æµ‹è¯•

### ğŸ” è°ƒè¯•åŠŸèƒ½

**è¯¦ç»†å¼‚å¸¸ä¿¡æ¯**ï¼š
```csharp
if (app.Environment.IsDevelopment())
{
    app.UseDeveloperExceptionPage();
}
```

**è¯·æ±‚å“åº”æ—¥å¿—**ï¼š
```csharp
public class RequestLoggingMiddleware
{
    public async Task InvokeAsync(HttpContext context, RequestDelegate next)
    {
        var stopwatch = Stopwatch.StartNew();
        
        _logger.LogInformation("Request {Method} {Path} started", 
            context.Request.Method, context.Request.Path);
        
        await next(context);
        
        stopwatch.Stop();
        _logger.LogInformation("Request {Method} {Path} completed in {ElapsedMilliseconds}ms with status {StatusCode}", 
            context.Request.Method, context.Request.Path, stopwatch.ElapsedMilliseconds, context.Response.StatusCode);
    }
}
```

## éƒ¨ç½²å’Œè¿ç»´

### ğŸš€ éƒ¨ç½²é…ç½®

**ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š
```json
{
  "GameServer": {
    "EnableDevelopmentTests": false,
    "EnablePerformanceMonitoring": true,
    "MaxConcurrentBattles": 200
  },
  "Security": {
    "Jwt": {
      "ExpirationMinutes": 60,
      "RefreshTokenExpirationMinutes": 43200
    },
    "RateLimit": {
      "IpRateLimit": {
        "MaxRequests": 1000,
        "TimeWindowMinutes": 1
      }
    }
  },
  "Serilog": {
    "MinimumLevel": {
      "Default": "Warning"
    }
  }
}
```

### ğŸ“Š ç›‘æ§æŒ‡æ ‡

**å…³é”®æ€§èƒ½æŒ‡æ ‡**ï¼š
- **å“åº”æ—¶é—´**: APIå¹³å‡å“åº”æ—¶é—´ < 200ms
- **ååé‡**: æ¯ç§’å¤„ç†è¯·æ±‚æ•° > 100 RPS
- **é”™è¯¯ç‡**: é”™è¯¯ç‡ < 1%
- **å†…å­˜ä½¿ç”¨**: å†…å­˜ä½¿ç”¨ç‡ < 80%
- **æ´»è·ƒè¿æ¥**: SignalRè¿æ¥æ•°ç›‘æ§

**ä¸šåŠ¡æŒ‡æ ‡**ï¼š
- æ´»è·ƒç”¨æˆ·æ•°
- å¹¶å‘æˆ˜æ–—æ•°
- å¹³å‡æˆ˜æ–—æ—¶é•¿
- ç”¨æˆ·ç•™å­˜ç‡

### ğŸ”„ æ‰©å±•æ€§è€ƒè™‘

**æ°´å¹³æ‰©å±•**ï¼š
- æ— çŠ¶æ€APIè®¾è®¡
- å¤–éƒ¨çŠ¶æ€å­˜å‚¨ï¼ˆRedisï¼‰
- è´Ÿè½½å‡è¡¡æ”¯æŒ
- å®¹å™¨åŒ–éƒ¨ç½²

**å‚ç›´æ‰©å±•**ï¼š
- èµ„æºç›‘æ§å’Œè‡ªåŠ¨æ‰©å®¹
- æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- CPUä½¿ç”¨æ•ˆç‡æå‡

---

## æ€»ç»“

BlazorWebGameæœåŠ¡ç«¯æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡ã€æ¶æ„å…ˆè¿›çš„Webæ¸¸æˆåç«¯ç³»ç»Ÿï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š

### âœ… æŠ€æœ¯ä¼˜åŠ¿
1. **ç°ä»£åŒ–æ¶æ„**: åŸºäº.NET 8.0å’ŒASP.NET Coreçš„æœ€æ–°æŠ€æœ¯æ ˆ
2. **å®æ—¶é€šä¿¡**: SignalRæä¾›ä½å»¶è¿Ÿçš„åŒå‘é€šä¿¡èƒ½åŠ›
3. **å®‰å…¨ä¿éšœ**: å®Œå–„çš„JWTè®¤è¯ã€æƒé™éªŒè¯å’Œé€Ÿç‡é™åˆ¶æœºåˆ¶
4. **é«˜å¯è§‚æµ‹æ€§**: è¯¦ç»†çš„æ—¥å¿—è®°å½•ã€å¥åº·æ£€æŸ¥å’Œæ€§èƒ½ç›‘æ§
5. **å¼€å‘å‹å¥½**: å®Œæ•´çš„APIæ–‡æ¡£ã€è‡ªåŠ¨åŒ–æµ‹è¯•å’Œè°ƒè¯•å·¥å…·

### âœ… åŠŸèƒ½å®Œæ•´æ€§
- **ç”¨æˆ·ç®¡ç†**: æ³¨å†Œã€ç™»å½•ã€è§’è‰²ç®¡ç†
- **æ¸¸æˆæ ¸å¿ƒ**: æˆ˜æ–—ç³»ç»Ÿã€é˜Ÿä¼ç®¡ç†ã€æŠ€èƒ½ç³»ç»Ÿ
- **å†…å®¹ç³»ç»Ÿ**: ä»»åŠ¡ã€å•†åº—ã€å£°æœ›ã€åˆ¶ä½œç³»ç»Ÿ
- **æ•°æ®ç®¡ç†**: èƒŒåŒ…ã€è£…å¤‡ã€æ•°æ®å­˜å‚¨ã€ç¦»çº¿ç»“ç®—
- **è¿ç»´æ”¯æŒ**: ç›‘æ§ã€å¥åº·æ£€æŸ¥ã€æ€§èƒ½åˆ†æ

### âœ… æ¶æ„ç‰¹ç‚¹
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„åŠŸèƒ½è¾¹ç•Œå’ŒèŒè´£åˆ†ç¦»
- **äº‹ä»¶é©±åŠ¨**: ç»Ÿä¸€çš„äº‹ä»¶ç³»ç»Ÿæ”¯æŒå¤æ‚ä¸šåŠ¡æµç¨‹
- **å¯é…ç½®**: çµæ´»çš„é…ç½®ç³»ç»Ÿé€‚åº”ä¸åŒéƒ¨ç½²ç¯å¢ƒ
- **å¯æ‰©å±•**: æ”¯æŒæ°´å¹³å’Œå‚ç›´æ‰©å±•çš„æ¶æ„è®¾è®¡

è¯¥æœåŠ¡ç«¯æ¶æ„ä¸ºWebæ¸¸æˆæä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œèƒ½å¤Ÿæ”¯æŒå¤§è§„æ¨¡ã€é«˜å¹¶å‘çš„æ¸¸æˆè¿è¥éœ€æ±‚ã€‚