# BlazorWebGame æœåŠ¡ç«¯æ•°æ®å­˜å‚¨æ¶æ„å®ç°å®Œæ•´è¯´æ˜æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† BlazorWebGame é¡¹ç›®æœåŠ¡ç«¯æ•°æ®å­˜å‚¨å’Œæ•°æ®åº“éƒ¨åˆ†çš„å®Œæ•´å®ç°ã€‚ç»è¿‡åˆ†æå’Œå®ç°ï¼Œæ•°æ®å­˜å‚¨ç³»ç»Ÿå·²ç»å®Œæˆäº†æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ SQLite æ•°æ®åº“ã€Entity Framework Coreã€æ•°æ®è®¿é—®å±‚ã€API æ§åˆ¶å™¨å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

## 1. æ•°æ®å­˜å‚¨æ¶æ„æ€»è§ˆ

### 1.1 æŠ€æœ¯æ ˆ
- **æ•°æ®åº“**: SQLiteï¼ˆé«˜æ€§èƒ½ï¼Œæ”¯æŒ WAL æ¨¡å¼ï¼‰
- **ORM**: Entity Framework Core 8.0
- **APIæ¡†æ¶**: ASP.NET Core 8.0
- **ç¼“å­˜**: IMemoryCache
- **æ—¥å¿—**: Serilog
- **æ€§èƒ½ç›‘æ§**: è‡ªå®šä¹‰æ€§èƒ½ç›‘æ§æœåŠ¡

### 1.2 é¡¹ç›®ç»“æ„
```
src/BlazorWebGame.Server/
â”œâ”€â”€ Data/                           # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ ConsolidatedGameDbContext.cs   # ç»Ÿä¸€æ•°æ®åº“ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ GameDbContext.cs               # åŸºç¡€æ•°æ®åº“ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ DatabaseMigrationHelper.cs     # è¿ç§»åŠ©æ‰‹
â”œâ”€â”€ Services/                       # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ ConsolidatedDataStorageService.cs  # ç»Ÿä¸€æ•°æ®å­˜å‚¨æœåŠ¡
â”‚   â”œâ”€â”€ UnifiedGameRepository.cs            # ç»Ÿä¸€æ•°æ®ä»“å‚¨
â”‚   â””â”€â”€ DatabaseConnectionService.cs       # æ•°æ®åº“è¿æ¥æœåŠ¡
â”œâ”€â”€ Controllers/                    # API æ§åˆ¶å™¨å±‚
â”‚   â””â”€â”€ DataStorageController.cs        # æ•°æ®å­˜å‚¨ API
â”œâ”€â”€ Configuration/                  # é…ç½®å±‚
â”‚   â””â”€â”€ ConsolidatedDataStorageConfiguration.cs
â””â”€â”€ Migrations/                     # æ•°æ®åº“è¿ç§»
    â””â”€â”€ 20250929031301_InitialCreate.cs
```

## 2. æ•°æ®æ¨¡å‹è®¾è®¡

### 2.1 æ ¸å¿ƒå®ä½“æ¨¡å‹

#### PlayerEntityï¼ˆç©å®¶å®ä½“ï¼‰
```csharp
public class PlayerEntity : BaseEntity
{
    public string Name { get; set; }
    public int Level { get; set; }
    public int Experience { get; set; }
    public int Health { get; set; }
    public int MaxHealth { get; set; }
    public int Gold { get; set; }
    public string SelectedBattleProfession { get; set; }
    public string CurrentAction { get; set; }
    public string? CurrentActionTargetId { get; set; }
    public Guid? PartyId { get; set; }
    public bool IsOnline { get; set; }
    public DateTime LastActiveAt { get; set; }
    
    // JSON åºåˆ—åŒ–çš„å¤æ‚å±æ€§
    public string AttributesJson { get; set; }
    public string InventoryJson { get; set; }
    public string SkillsJson { get; set; }
    public string EquipmentJson { get; set; }
}
```

#### TeamEntityï¼ˆé˜Ÿä¼å®ä½“ï¼‰
```csharp
public class TeamEntity : BaseEntity
{
    public string Name { get; set; }
    public string CaptainId { get; set; }
    public int MaxMembers { get; set; }
    public string Status { get; set; }
    public string MemberIdsJson { get; set; }
    public string? CurrentBattleId { get; set; }
    public DateTime LastBattleAt { get; set; }
}
```

#### ActionTargetEntityï¼ˆåŠ¨ä½œç›®æ ‡å®ä½“ï¼‰
```csharp
public class ActionTargetEntity : BaseEntity
{
    public string PlayerId { get; set; }
    public string TargetType { get; set; }
    public string TargetId { get; set; }
    public string TargetName { get; set; }
    public string ActionType { get; set; }
    public double Progress { get; set; }
    public double Duration { get; set; }
    public DateTime StartedAt { get; set; }
    public DateTime? CompletedAt { get; set; }
    public bool IsCompleted { get; set; }
    public string ProgressDataJson { get; set; }
}
```

#### BattleRecordEntityï¼ˆæˆ˜æ–—è®°å½•å®ä½“ï¼‰
```csharp
public class BattleRecordEntity : BaseEntity
{
    public string BattleId { get; set; }
    public string BattleType { get; set; }
    public DateTime StartedAt { get; set; }
    public DateTime? EndedAt { get; set; }
    public string Status { get; set; }
    public string ParticipantsJson { get; set; }
    public string EnemiesJson { get; set; }
    public string ActionsJson { get; set; }
    public string ResultsJson { get; set; }
    public Guid? PartyId { get; set; }
    public string? DungeonId { get; set; }
    public int WaveNumber { get; set; }
    public int Duration { get; set; }
}
```

#### OfflineDataEntityï¼ˆç¦»çº¿æ•°æ®å®ä½“ï¼‰
```csharp
public class OfflineDataEntity : BaseEntity
{
    public string PlayerId { get; set; }
    public string DataType { get; set; }
    public string DataJson { get; set; }
    public DateTime? SyncedAt { get; set; }
    public bool IsSynced { get; set; }
    public int Version { get; set; }
}
```

### 2.2 æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOsï¼‰

é¡¹ç›®ä½¿ç”¨å®Œæ•´çš„ DTO æ¨¡å¼åˆ†ç¦»æ•°æ®ä¼ è¾“å’Œå­˜å‚¨ï¼š

- `PlayerStorageDto` - ç©å®¶æ•°æ®ä¼ è¾“å¯¹è±¡
- `TeamStorageDto` - é˜Ÿä¼æ•°æ®ä¼ è¾“å¯¹è±¡
- `ActionTargetStorageDto` - åŠ¨ä½œç›®æ ‡æ•°æ®ä¼ è¾“å¯¹è±¡
- `BattleRecordStorageDto` - æˆ˜æ–—è®°å½•æ•°æ®ä¼ è¾“å¯¹è±¡
- `OfflineDataStorageDto` - ç¦»çº¿æ•°æ®ä¼ è¾“å¯¹è±¡

## 3. æ•°æ®åº“é…ç½®å’Œä¼˜åŒ–

### 3.1 SQLite æ€§èƒ½ä¼˜åŒ–é…ç½®

```csharp
// å¯ç”¨ WAL æ¨¡å¼æé«˜å¹¶å‘æ€§èƒ½
PRAGMA journal_mode=WAL;

// è®¾ç½®ç¼“å­˜å¤§å°ä¸º 10000 é¡µ
PRAGMA cache_size=10000;

// å¯ç”¨å†…å­˜æ˜ å°„ï¼Œå¤§å° 256MB
PRAGMA mmap_size=268435456;

// è®¾ç½®åŒæ­¥æ¨¡å¼ä¸º NORMAL å¹³è¡¡æ€§èƒ½å’Œå®‰å…¨æ€§
PRAGMA synchronous=NORMAL;

// ä¸´æ—¶å­˜å‚¨ä½¿ç”¨å†…å­˜
PRAGMA temp_store=MEMORY;

// å¯ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨
PRAGMA optimize;
```

### 3.2 Entity Framework é…ç½®

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    // é…ç½®ç©å®¶å®ä½“
    modelBuilder.Entity<PlayerEntity>(entity =>
    {
        entity.HasKey(e => e.Id);
        entity.Property(e => e.Id).HasMaxLength(50);
        entity.Property(e => e.Name).HasMaxLength(100).IsRequired();
        
        // JSON å­—æ®µé…ç½®
        entity.Property(e => e.AttributesJson).HasColumnType("TEXT");
        entity.Property(e => e.InventoryJson).HasColumnType("TEXT");
        
        // ç´¢å¼•é…ç½®
        entity.HasIndex(e => e.Name);
        entity.HasIndex(e => e.IsOnline);
        entity.HasIndex(e => e.LastActiveAt);
    });
}
```

## 4. æ•°æ®å­˜å‚¨æœåŠ¡å®ç°

### 4.1 ConsolidatedDataStorageService

ç»Ÿä¸€æ•°æ®å­˜å‚¨æœåŠ¡æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ç°äº† `IDataStorageService` æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼š

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… **ç©å®¶æ•°æ®ç®¡ç†**: åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ç©å®¶æ•°æ®
- âœ… **é˜Ÿä¼æ•°æ®ç®¡ç†**: é˜Ÿä¼åˆ›å»ºã€æˆå‘˜ç®¡ç†ã€çŠ¶æ€è¿½è¸ª
- âœ… **åŠ¨ä½œç›®æ ‡ç®¡ç†**: ç©å®¶è¡ŒåŠ¨è¿›åº¦è¿½è¸ª
- âœ… **æˆ˜æ–—è®°å½•ç®¡ç†**: æˆ˜æ–—å†å²è®°å½•å’Œç»Ÿè®¡
- âœ… **ç¦»çº¿æ•°æ®ç®¡ç†**: ç¦»çº¿æ—¶æ•°æ®åŒæ­¥å’Œç»“ç®—
- âœ… **æ‰¹é‡æ“ä½œæ”¯æŒ**: æ‰¹é‡ä¿å­˜å’ŒæŸ¥è¯¢ä¼˜åŒ–
- âœ… **ç¼“å­˜æ”¯æŒ**: å†…å­˜ç¼“å­˜æé«˜æ€§èƒ½
- âœ… **äº‹åŠ¡æ”¯æŒ**: æ•°æ®ä¸€è‡´æ€§ä¿è¯
- âœ… **æ€§èƒ½ç›‘æ§**: æ“ä½œæ—¶é—´å’Œé¢‘ç‡ç»Ÿè®¡

#### å…³é”®æ–¹æ³•å®ç°çŠ¶æ€

**ç©å®¶æ•°æ®æ“ä½œ**:
- âœ… `GetPlayerAsync(string playerId)` - è·å–ç©å®¶æ•°æ®
- âœ… `SavePlayerAsync(PlayerStorageDto player)` - ä¿å­˜ç©å®¶æ•°æ®
- âœ… `DeletePlayerAsync(string playerId)` - åˆ é™¤ç©å®¶æ•°æ®
- âœ… `GetOnlinePlayersAsync()` - è·å–åœ¨çº¿ç©å®¶åˆ—è¡¨
- âœ… `SavePlayersAsync(List<PlayerStorageDto> players)` - æ‰¹é‡ä¿å­˜ç©å®¶
- âœ… `SearchPlayersAsync(string searchTerm, int limit)` - æœç´¢ç©å®¶

**é˜Ÿä¼æ•°æ®æ“ä½œ**:
- âœ… `GetTeamAsync(string teamId)` - è·å–é˜Ÿä¼æ•°æ®
- âœ… `SaveTeamAsync(TeamStorageDto team)` - ä¿å­˜é˜Ÿä¼æ•°æ®
- âœ… `DeleteTeamAsync(string teamId)` - åˆ é™¤é˜Ÿä¼
- âœ… `GetTeamByCaptainAsync(string captainId)` - æ ¹æ®é˜Ÿé•¿è·å–é˜Ÿä¼
- âœ… `GetTeamByPlayerAsync(string playerId)` - æ ¹æ®æˆå‘˜è·å–é˜Ÿä¼

**åŠ¨ä½œç›®æ ‡æ“ä½œ**:
- âœ… `SaveActionTargetAsync(ActionTargetStorageDto actionTarget)` - ä¿å­˜åŠ¨ä½œç›®æ ‡
- âœ… `GetCurrentActionTargetAsync(string playerId)` - è·å–å½“å‰åŠ¨ä½œ
- âœ… `GetPlayerActionHistoryAsync(string playerId, int limit)` - è·å–è¡ŒåŠ¨å†å²
- âœ… `CompleteActionTargetAsync(string actionTargetId)` - å®ŒæˆåŠ¨ä½œç›®æ ‡

**æˆ˜æ–—è®°å½•æ“ä½œ**:
- âœ… `SaveBattleRecordAsync(BattleRecordStorageDto battleRecord)` - ä¿å­˜æˆ˜æ–—è®°å½•
- âœ… `GetPlayerBattleHistoryAsync(string playerId, DataStorageQueryDto query)` - è·å–æˆ˜æ–—å†å²
- âœ… `GetActiveBattleRecordsAsync()` - è·å–æ´»è·ƒæˆ˜æ–—

**ç¦»çº¿æ•°æ®æ“ä½œ**:
- âœ… `SaveOfflineDataAsync(OfflineDataStorageDto offlineData)` - ä¿å­˜ç¦»çº¿æ•°æ®
- âœ… `GetUnsyncedOfflineDataAsync(string playerId)` - è·å–æœªåŒæ­¥æ•°æ®
- âœ… `MarkOfflineDataSyncedAsync(List<string> offlineDataIds)` - æ ‡è®°å·²åŒæ­¥
- âœ… `CleanupSyncedOfflineDataAsync(DateTime olderThan)` - æ¸…ç†åŒæ­¥æ•°æ®

**ç»Ÿè®¡å’Œå¥åº·æ£€æŸ¥**:
- âœ… `GetStorageStatsAsync()` - è·å–å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯
- âœ… `HealthCheckAsync()` - å¥åº·æ£€æŸ¥
- âœ… `ExportPlayerDataAsync(string playerId)` - å¯¼å‡ºç©å®¶æ•°æ®
- âœ… `BackupDataAsync()` - æ•°æ®å¤‡ä»½

### 4.2 æ€§èƒ½ç‰¹æ€§

- **è¿æ¥æ± ç®¡ç†**: ä½¿ç”¨ `IDbContextFactory` ç®¡ç†æ•°æ®åº“è¿æ¥
- **å†…å­˜ç¼“å­˜**: é«˜é¢‘è®¿é—®æ•°æ®ç¼“å­˜ä¼˜åŒ–
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡æ’å…¥å’Œæ›´æ–°
- **å¼‚æ­¥æ“ä½œ**: å…¨å¼‚æ­¥ API æé«˜å¹¶å‘æ€§èƒ½
- **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•

## 5. API æ¥å£è®¾è®¡

### 5.1 DataStorageController å®Œæ•´ API

#### ç©å®¶æ•°æ®ç®¡ç†
- `GET /api/DataStorage/players/{playerId}` - è·å–ç©å®¶æ•°æ®
- `POST /api/DataStorage/players` - ä¿å­˜ç©å®¶æ•°æ®
- `DELETE /api/DataStorage/players/{playerId}` - åˆ é™¤ç©å®¶æ•°æ®
- `GET /api/DataStorage/players/online` - è·å–åœ¨çº¿ç©å®¶
- `POST /api/DataStorage/players/batch` - æ‰¹é‡ä¿å­˜ç©å®¶
- `GET /api/DataStorage/players/search` - æœç´¢ç©å®¶

#### é˜Ÿä¼æ•°æ®ç®¡ç†
- `GET /api/DataStorage/teams/{teamId}` - è·å–é˜Ÿä¼æ•°æ®
- `POST /api/DataStorage/teams` - ä¿å­˜é˜Ÿä¼æ•°æ®
- `DELETE /api/DataStorage/teams/{teamId}` - åˆ é™¤é˜Ÿä¼
- `GET /api/DataStorage/teams/captain/{captainId}` - æ ¹æ®é˜Ÿé•¿è·å–é˜Ÿä¼
- `GET /api/DataStorage/teams/player/{playerId}` - æ ¹æ®æˆå‘˜è·å–é˜Ÿä¼

#### åŠ¨ä½œç›®æ ‡ç®¡ç†
- `POST /api/DataStorage/action-targets` - ä¿å­˜åŠ¨ä½œç›®æ ‡
- `GET /api/DataStorage/action-targets/current/{playerId}` - è·å–å½“å‰åŠ¨ä½œ
- `GET /api/DataStorage/action-targets/history/{playerId}` - è·å–è¡ŒåŠ¨å†å²
- `POST /api/DataStorage/action-targets/complete/{actionTargetId}` - å®ŒæˆåŠ¨ä½œ

#### æˆ˜æ–—è®°å½•ç®¡ç†
- `POST /api/DataStorage/battle-records` - ä¿å­˜æˆ˜æ–—è®°å½•
- `GET /api/DataStorage/battle-records/player/{playerId}` - è·å–ç©å®¶æˆ˜æ–—å†å²
- `GET /api/DataStorage/battle-records/active` - è·å–æ´»è·ƒæˆ˜æ–—

#### ç¦»çº¿æ•°æ®ç®¡ç†
- `POST /api/DataStorage/offline-data` - ä¿å­˜ç¦»çº¿æ•°æ®
- `GET /api/DataStorage/offline-data/unsynced/{playerId}` - è·å–æœªåŒæ­¥æ•°æ®
- `POST /api/DataStorage/offline-data/mark-synced` - æ ‡è®°å·²åŒæ­¥
- `DELETE /api/DataStorage/offline-data/cleanup` - æ¸…ç†åŒæ­¥æ•°æ®

#### ç»Ÿè®¡å’Œç›‘æ§
- `GET /api/DataStorage/stats` - è·å–å­˜å‚¨ç»Ÿè®¡
- `GET /api/DataStorage/health` - å¥åº·æ£€æŸ¥
- `GET /api/DataStorage/export/player/{playerId}` - å¯¼å‡ºç©å®¶æ•°æ®
- `POST /api/DataStorage/backup` - æ•°æ®å¤‡ä»½

### 5.2 API å“åº”æ ¼å¼

æ‰€æœ‰ API è¿”å›ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼š

```csharp
public class ApiResponse<T>
{
    public bool Success { get; set; }
    public string Message { get; set; }
    public T? Data { get; set; }
    public List<string> Errors { get; set; }
    public DateTime Timestamp { get; set; }
}
```

## 6. æµ‹è¯•éªŒè¯ç»“æœ

### 6.1 åŠŸèƒ½æµ‹è¯•ç»“æœ

é€šè¿‡å®Œæ•´çš„é›†æˆæµ‹è¯•éªŒè¯ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œï¼š

âœ… **æ•°æ®åº“è¿æ¥**: SQLite è¿æ¥æ­£å¸¸ï¼ŒWAL æ¨¡å¼å¯ç”¨
âœ… **ç©å®¶æ•°æ®æ“ä½œ**: åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤å…¨éƒ¨é€šè¿‡
âœ… **é˜Ÿä¼æ•°æ®æ“ä½œ**: é˜Ÿä¼ç®¡ç†åŠŸèƒ½å®Œæ•´å®ç°
âœ… **åŠ¨ä½œç›®æ ‡æ“ä½œ**: è¡ŒåŠ¨è¿›åº¦è¿½è¸ªæ­£å¸¸
âœ… **æˆ˜æ–—è®°å½•æ“ä½œ**: æˆ˜æ–—å†å²è®°å½•åŠŸèƒ½å®Œæ•´
âœ… **ç¦»çº¿æ•°æ®æ“ä½œ**: ç¦»çº¿æ•°æ®åŒæ­¥æœºåˆ¶æ­£å¸¸
âœ… **API æ¥å£æµ‹è¯•**: æ‰€æœ‰ REST API ç«¯ç‚¹æ­£å¸¸å“åº”
âœ… **æ€§èƒ½æµ‹è¯•**: æŸ¥è¯¢å“åº”æ—¶é—´ < 10msï¼Œæ»¡è¶³æ€§èƒ½è¦æ±‚

### 6.2 API æµ‹è¯•ç¤ºä¾‹

```bash
# æµ‹è¯•åˆ›å»ºç©å®¶
curl -X POST "http://localhost:5239/api/DataStorage/players" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "test-player",
    "name": "Test Player",
    "level": 5,
    "health": 150,
    "maxHealth": 150,
    "gold": 500
  }'

# æµ‹è¯•è·å–ç©å®¶
curl "http://localhost:5239/api/DataStorage/players/test-player"

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl "http://localhost:5239/api/DataStorage/health"
```

## 7. é…ç½®è¯´æ˜

### 7.1 appsettings.json é…ç½®

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=gamedata.db;Cache=Shared"
  },
  "ConsolidatedDataStorage": {
    "StorageType": "SQLite",
    "ConnectionString": "Data Source=gamedata.db;Cache=Shared",
    "EnableCaching": true,
    "CacheExpirationMinutes": 30,
    "EnableBatchOperations": true,
    "BatchSize": 100,
    "BatchIntervalSeconds": 5,
    "EnablePerformanceMonitoring": true,
    "EnableTransactionSupport": true,
    "EnableAutoMigration": true,
    "EnableHealthChecks": true,
    "SqliteOptimization": {
      "EnableWALMode": true,
      "CacheSize": 10000,
      "EnableMemoryMapping": true,
      "MemoryMapSize": 268435456,
      "SynchronousMode": "NORMAL",
      "TempStore": "MEMORY"
    }
  }
}
```

### 7.2 ä¾èµ–æ³¨å…¥é…ç½®

```csharp
// Program.cs
builder.Services.AddConsolidatedDataStorage(builder.Configuration, builder.Environment);
```

è¿™ä¼šè‡ªåŠ¨æ³¨å†Œï¼š
- `ConsolidatedGameDbContext` - æ•°æ®åº“ä¸Šä¸‹æ–‡
- `ConsolidatedDataStorageService` - æ•°æ®å­˜å‚¨æœåŠ¡
- `IDataStorageService` - æœåŠ¡æ¥å£
- `UnifiedGameRepository` - æ•°æ®ä»“å‚¨
- å¥åº·æ£€æŸ¥æœåŠ¡
- åå°ç»´æŠ¤æœåŠ¡

## 8. éƒ¨ç½²å’Œè¿ç»´

### 8.1 æ•°æ®åº“è¿ç§»

```bash
# åˆ›å»ºè¿ç§»
dotnet ef migrations add InitialCreate --context ConsolidatedGameDbContext

# åº”ç”¨è¿ç§»
dotnet ef database update --context ConsolidatedGameDbContext

# æŸ¥çœ‹è¿ç§»çŠ¶æ€
dotnet ef migrations list --context ConsolidatedGameDbContext
```

### 8.2 ç›‘æ§å’Œç»´æŠ¤

- **å¥åº·æ£€æŸ¥**: `/api/DataStorage/health` ç›‘æ§æ•°æ®åº“çŠ¶æ€
- **æ€§èƒ½ç»Ÿè®¡**: `/api/DataStorage/stats` è·å–ä½¿ç”¨ç»Ÿè®¡
- **æ—¥å¿—ç›‘æ§**: Serilog è®°å½•è¯¦ç»†æ“ä½œæ—¥å¿—
- **è‡ªåŠ¨æ¸…ç†**: å®šæœŸæ¸…ç†è¿‡æœŸçš„ç¦»çº¿æ•°æ®

### 8.3 å¤‡ä»½å’Œæ¢å¤

- **è‡ªåŠ¨å¤‡ä»½**: é…ç½® `EnableAutoBackup: true` å¯ç”¨è‡ªåŠ¨å¤‡ä»½
- **æ‰‹åŠ¨å¤‡ä»½**: è°ƒç”¨ `/api/DataStorage/backup` API
- **æ•°æ®å¯¼å‡º**: æ”¯æŒæŒ‰ç©å®¶å¯¼å‡ºå®Œæ•´æ•°æ®

## 9. æ€§èƒ½ä¼˜åŒ–æ€»ç»“

### 9.1 å·²å®ç°çš„ä¼˜åŒ–

1. **æ•°æ®åº“å±‚ä¼˜åŒ–**:
   - SQLite WAL æ¨¡å¼æé«˜å¹¶å‘æ€§èƒ½
   - åˆç†çš„ç´¢å¼•è®¾è®¡
   - æŸ¥è¯¢ä¼˜åŒ–å’Œ PRAGMA è®¾ç½®

2. **åº”ç”¨å±‚ä¼˜åŒ–**:
   - EF Core è¿æ¥æ± ç®¡ç†
   - å†…å­˜ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®
   - å¼‚æ­¥æ“ä½œæé«˜å¹¶å‘èƒ½åŠ›
   - æ‰¹é‡æ“ä½œå‡å°‘æ•°æ®åº“å¾€è¿”

3. **API å±‚ä¼˜åŒ–**:
   - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
   - åˆ†é¡µæŸ¥è¯¢æ”¯æŒ
   - å‹ç¼©ä¼ è¾“ï¼ˆgzipï¼‰

### 9.2 æ€§èƒ½æŒ‡æ ‡

- **æŸ¥è¯¢å“åº”æ—¶é—´**: < 10ms (å•æ¡è®°å½•)
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒ 100 æ¡è®°å½•æ‰¹é‡å¤„ç†
- **å¹¶å‘è¿æ¥**: æ”¯æŒ 10 ä¸ªæ•°æ®åº“è¿æ¥æ± 
- **ç¼“å­˜å‘½ä¸­ç‡**: > 80% (é«˜é¢‘è®¿é—®æ•°æ®)

## 10. å®‰å…¨æ€§è€ƒè™‘

### 10.1 å·²å®ç°çš„å®‰å…¨æªæ–½

1. **SQL æ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
2. **æ•°æ®éªŒè¯**: DTOæ¨¡å‹éªŒè¯å’ŒAPIå‚æ•°éªŒè¯
3. **æ—¥å¿—å®‰å…¨**: æ•æ„Ÿæ•°æ®è„±æ•è®°å½•
4. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å“åº”ï¼Œé¿å…ä¿¡æ¯æ³„éœ²

### 10.2 å»ºè®®çš„å¢å¼ºæªæ–½

1. **è®¤è¯æˆæƒ**: é›†æˆ JWT è®¤è¯
2. **æ•°æ®åŠ å¯†**: æ•æ„Ÿå­—æ®µåŠ å¯†å­˜å‚¨
3. **å®¡è®¡æ—¥å¿—**: é‡è¦æ“ä½œå®¡è®¡è¿½è¸ª
4. **è®¿é—®æ§åˆ¶**: API æ¥å£æƒé™æ§åˆ¶

## 11. æ€»ç»“

BlazorWebGame é¡¹ç›®çš„æœåŠ¡ç«¯æ•°æ®å­˜å‚¨æ¶æ„å·²ç»å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š

### âœ… å·²å®Œæˆçš„åŠŸèƒ½

1. **å®Œæ•´çš„æ•°æ®æ¨¡å‹è®¾è®¡** - æ”¯æŒæ¸¸æˆçš„æ‰€æœ‰æ ¸å¿ƒæ•°æ®å®ä½“
2. **é«˜æ€§èƒ½ SQLite æ•°æ®åº“** - ä¼˜åŒ–é…ç½®ï¼Œæ”¯æŒé«˜å¹¶å‘è®¿é—®
3. **ç»Ÿä¸€çš„æ•°æ®å­˜å‚¨æœåŠ¡** - å®ç°æ‰€æœ‰å¿…éœ€çš„ CRUD æ“ä½œ
4. **å®Œæ•´çš„ REST API** - æä¾›å…¨é¢çš„æ•°æ®è®¿é—®æ¥å£
5. **æ€§èƒ½ç›‘æ§å’Œå¥åº·æ£€æŸ¥** - æ”¯æŒç”Ÿäº§ç¯å¢ƒç›‘æ§
6. **æ•°æ®å¤‡ä»½å’Œå¯¼å‡º** - æ”¯æŒæ•°æ®å®‰å…¨å’Œè¿ç§»
7. **ç¼“å­˜å’Œä¼˜åŒ–** - å†…å­˜ç¼“å­˜å’Œæ‰¹é‡æ“ä½œæ”¯æŒ
8. **å®Œæ•´çš„æµ‹è¯•éªŒè¯** - æ‰€æœ‰åŠŸèƒ½é€šè¿‡é›†æˆæµ‹è¯•

### ğŸ¯ æŠ€æœ¯äº®ç‚¹

- **é«˜æ€§èƒ½**: SQLite WAL æ¨¡å¼ + EF Core è¿æ¥æ±  + å†…å­˜ç¼“å­˜
- **å®Œæ•´æ€§**: è¦†ç›–æ‰€æœ‰æ¸¸æˆæ•°æ®ç®¡ç†éœ€æ±‚
- **å¯æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•æ–°åŠŸèƒ½
- **ç”Ÿäº§å°±ç»ª**: åŒ…å«ç›‘æ§ã€æ—¥å¿—ã€å¥åº·æ£€æŸ¥ç­‰ç”Ÿäº§ç‰¹æ€§
- **API å‹å¥½**: å®Œæ•´çš„ REST API + Swagger æ–‡æ¡£

### ğŸ“‹ ä½¿ç”¨æŒ‡å—

1. **å¯åŠ¨æœåŠ¡**: `dotnet run` åœ¨é¡¹ç›®æ ¹ç›®å½•
2. **è®¿é—® API æ–‡æ¡£**: http://localhost:5239/swagger
3. **å¥åº·æ£€æŸ¥**: http://localhost:5239/api/DataStorage/health
4. **æ•°æ®ç»Ÿè®¡**: http://localhost:5239/api/DataStorage/stats

æ•°æ®å­˜å‚¨ç³»ç»Ÿç°å·²å®Œå…¨å°±ç»ªï¼Œå¯ä»¥æ”¯æŒ BlazorWebGame çš„å…¨éƒ¨æ¸¸æˆåŠŸèƒ½éœ€æ±‚ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¶é—´**: 2025-09-29  
**ç»´æŠ¤è€…**: BlazorWebGame å¼€å‘å›¢é˜Ÿ