# BlazorWebGame.Rebuild å¿«é€Ÿå¼€å§‹æŒ‡å—

## 1. é¡¹ç›®ç¼–è¯‘

### æ¢å¤ä¾èµ–åŒ…

```bash
cd src/BlazorWebGame.Rebuild
dotnet restore
```

### ç¼–è¯‘é¡¹ç›®

```bash
dotnet build
```

**é¢„æœŸç»“æœ**:
```
Build succeeded.
    102 Warning(s)
    0 Error(s)
```

## 2. è¿è¡Œé¡¹ç›®

### åŸºæœ¬è¿è¡Œ

```bash
dotnet run
```

### æŒ‡å®šç«¯å£è¿è¡Œ

```bash
dotnet run --urls="https://localhost:7052;http://localhost:5191"
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**:
```
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: https://localhost:7052
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5191
```

## 3. è®¿é—® API

### Swagger UI

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
https://localhost:7052/swagger
```

æ‚¨å°†çœ‹åˆ°å®Œæ•´çš„ API æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š
- 15 ä¸ªæ§åˆ¶å™¨
- 80+ ä¸ª API ç«¯ç‚¹
- å¯äº¤äº’çš„ API æµ‹è¯•ç•Œé¢

### å¥åº·æ£€æŸ¥

```bash
curl https://localhost:7052/health
```

### æµ‹è¯• API ç«¯ç‚¹

#### 1. ç”¨æˆ·æ³¨å†Œ

```bash
curl -X POST https://localhost:7052/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "Test123456!",
    "email": "test@example.com"
  }'
```

#### 2. ç”¨æˆ·ç™»å½•

```bash
curl -X POST https://localhost:7052/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "Test123456!"
  }'
```

**è¿”å›ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userId": "123",
    "username": "testuser"
  }
}
```

#### 3. åˆ›å»ºè§’è‰²ï¼ˆéœ€è¦è®¤è¯ï¼‰

```bash
curl -X POST https://localhost:7052/api/character/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "name": "å‹‡è€…"
  }'
```

#### 4. è·å–è§’è‰²åˆ—è¡¨

```bash
curl -X GET https://localhost:7052/api/character/list \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

## 4. ä½¿ç”¨ SignalR å®æ—¶é€šä¿¡

### JavaScript å®¢æˆ·ç«¯ç¤ºä¾‹

```javascript
// å®‰è£… SignalR å®¢æˆ·ç«¯
// npm install @microsoft/signalr

import * as signalR from "@microsoft/signalr";

// åˆ›å»ºè¿æ¥
const connection = new signalR.HubConnectionBuilder()
    .withUrl("https://localhost:7052/gamehub", {
        accessTokenFactory: () => "YOUR_JWT_TOKEN"
    })
    .withAutomaticReconnect()
    .build();

// ç›‘å¬äº‹ä»¶
connection.on("ReceiveBattleUpdate", (battleState) => {
    console.log("æˆ˜æ–—çŠ¶æ€æ›´æ–°:", battleState);
});

connection.on("ReceiveCharacterUpdate", (character) => {
    console.log("è§’è‰²çŠ¶æ€æ›´æ–°:", character);
});

// å»ºç«‹è¿æ¥
await connection.start();
console.log("SignalR å·²è¿æ¥");

// å‘é€æ¶ˆæ¯
await connection.invoke("JoinBattle", "battle-id-123");
```

### C# å®¢æˆ·ç«¯ç¤ºä¾‹

```csharp
using Microsoft.AspNetCore.SignalR.Client;

var connection = new HubConnectionBuilder()
    .WithUrl("https://localhost:7052/gamehub", options =>
    {
        options.AccessTokenProvider = () => Task.FromResult("YOUR_JWT_TOKEN");
    })
    .WithAutomaticReconnect()
    .Build();

// ç›‘å¬äº‹ä»¶
connection.On<BattleStateDto>("ReceiveBattleUpdate", battleState =>
{
    Console.WriteLine($"æˆ˜æ–—çŠ¶æ€æ›´æ–°: {battleState.BattleId}");
});

// è¿æ¥
await connection.StartAsync();
Console.WriteLine("SignalR å·²è¿æ¥");

// è°ƒç”¨æ–¹æ³•
await connection.InvokeAsync("JoinBattle", "battle-id-123");
```

## 5. æ•°æ®åº“æ“ä½œ

### æŸ¥çœ‹æ•°æ®åº“

é¡¹ç›®ä½¿ç”¨ SQLite æ•°æ®åº“ï¼Œæ–‡ä»¶ä½ç½®ï¼š
```
src/BlazorWebGame.Rebuild/gamedata.db
```

### ä½¿ç”¨ SQLite å·¥å…·æŸ¥çœ‹

```bash
# å®‰è£… SQLite
sudo apt install sqlite3

# æ‰“å¼€æ•°æ®åº“
sqlite3 gamedata.db

# æŸ¥çœ‹æ‰€æœ‰è¡¨
.tables

# æŸ¥çœ‹è¡¨ç»“æ„
.schema Users

# æŸ¥è¯¢æ•°æ®
SELECT * FROM Users;
SELECT * FROM Players;
```

### Entity Framework Core è¿ç§»

å¦‚æœéœ€è¦ä¿®æ”¹æ•°æ®åº“ç»“æ„ï¼š

```bash
# æ·»åŠ è¿ç§»
dotnet ef migrations add YourMigrationName

# æ›´æ–°æ•°æ®åº“
dotnet ef database update

# å›æ»šè¿ç§»
dotnet ef database update PreviousMigration

# åˆ é™¤æœ€åä¸€ä¸ªè¿ç§»
dotnet ef migrations remove
```

## 6. å¼€å‘è°ƒè¯•

### Visual Studio Code

1. æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹
```bash
code src/BlazorWebGame.Rebuild
```

2. æŒ‰ F5 å¼€å§‹è°ƒè¯•

### Visual Studio

1. æ‰“å¼€è§£å†³æ–¹æ¡ˆ
```bash
start BlazorWebGame.sln
```

2. è®¾ç½® BlazorWebGame.Rebuild ä¸ºå¯åŠ¨é¡¹ç›®

3. æŒ‰ F5 å¼€å§‹è°ƒè¯•

### æ—¥å¿—æŸ¥çœ‹

æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š
```
src/BlazorWebGame.Rebuild/logs/
```

å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
tail -f logs/blazorwebgame-*.log
```

## 7. æµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
dotnet test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
dotnet test --filter "ClassName=DataStorageServiceTests"
```

### æµ‹è¯•è¦†ç›–ç‡

```bash
dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura
```

## 8. æ€§èƒ½ç›‘æ§

### è®¿é—®ç›‘æ§ç«¯ç‚¹

```bash
# æœåŠ¡å™¨çŠ¶æ€
curl https://localhost:7052/api/monitoring/server-status

# æ€§èƒ½æŒ‡æ ‡
curl https://localhost:7052/api/monitoring/performance-metrics

# æ¸¸æˆç»Ÿè®¡
curl https://localhost:7052/api/monitoring/game-statistics
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "data": {
    "uptime": "02:30:15",
    "memoryUsage": 125.5,
    "cpuUsage": 12.3,
    "activeConnections": 42,
    "requestsPerSecond": 150.2
  }
}
```

## 9. å¸¸è§é—®é¢˜

### Q1: ç«¯å£è¢«å ç”¨

**é”™è¯¯**: `Failed to bind to address https://localhost:7052`

**è§£å†³**:
```bash
# ä¿®æ”¹ç«¯å£
dotnet run --urls="https://localhost:8052;http://localhost:6191"
```

æˆ–ç¼–è¾‘ `appsettings.json`:
```json
{
  "Kestrel": {
    "Endpoints": {
      "Https": {
        "Url": "https://localhost:8052"
      }
    }
  }
}
```

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `Cannot open database`

**è§£å†³**:
1. ç¡®ä¿æœ‰å†™å…¥æƒé™
```bash
chmod 664 gamedata.db
```

2. åˆ é™¤å¹¶é‡æ–°åˆ›å»ºæ•°æ®åº“
```bash
rm gamedata.db
dotnet run
```

### Q3: JWT è®¤è¯å¤±è´¥

**é”™è¯¯**: `401 Unauthorized`

**è§£å†³**:
1. æ£€æŸ¥ JWT é…ç½®ï¼ˆappsettings.jsonï¼‰
2. ç¡®ä¿ token æœªè¿‡æœŸ
3. éªŒè¯ Bearer token æ ¼å¼ï¼š`Authorization: Bearer YOUR_TOKEN`

### Q4: CORS é”™è¯¯

**é”™è¯¯**: `CORS policy blocked`

**è§£å†³**:
ç¼–è¾‘ `appsettings.json`:
```json
{
  "Security": {
    "Cors": {
      "AllowedOrigins": [
        "https://localhost:7051",
        "http://localhost:5190",
        "https://your-domain.com"
      ]
    }
  }
}
```

## 10. ç”Ÿäº§éƒ¨ç½²

### å‘å¸ƒç‰ˆæœ¬

```bash
dotnet publish -c Release -o ./publish
```

### Docker éƒ¨ç½²

åˆ›å»º `Dockerfile`:
```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:8.0
WORKDIR /app
COPY ./publish .
EXPOSE 80
EXPOSE 443
ENTRYPOINT ["dotnet", "BlazorWebGame.Rebuild.dll"]
```

æ„å»ºé•œåƒï¼š
```bash
docker build -t blazorwebgame-rebuild .
```

è¿è¡Œå®¹å™¨ï¼š
```bash
docker run -d -p 8080:80 -p 8443:443 blazorwebgame-rebuild
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
export ASPNETCORE_ENVIRONMENT=Production
export ConnectionStrings__GameDatabase="Data Source=/data/gamedata.db"
export Jwt__Key="your-super-secret-key-min-32-chars"
export Jwt__Issuer="BlazorWebGame"
export Jwt__Audience="BlazorWebGame.Client"
```

## 11. å¼€å‘å·¥ä½œæµ

### å…¸å‹çš„å¼€å‘æµç¨‹

1. **å¯åŠ¨é¡¹ç›®**
```bash
dotnet run
```

2. **ä¿®æ”¹ä»£ç **ï¼ˆå®æ—¶é‡æ–°åŠ è½½å·²å¯ç”¨ï¼‰

3. **æµ‹è¯• API**ï¼ˆä½¿ç”¨ Swagger æˆ– Postmanï¼‰

4. **æŸ¥çœ‹æ—¥å¿—**
```bash
tail -f logs/blazorwebgame-*.log
```

5. **è¿è¡Œæµ‹è¯•**
```bash
dotnet test
```

6. **æäº¤ä»£ç **
```bash
git add .
git commit -m "Your changes"
git push
```

## 12. æ¨èå·¥å…·

### API æµ‹è¯•
- **Swagger UI** (å†…ç½®): https://localhost:7052/swagger
- **Postman**: å¯¼å…¥ Swagger JSON
- **curl**: å‘½ä»¤è¡Œæµ‹è¯•

### æ•°æ®åº“ç®¡ç†
- **DB Browser for SQLite**: GUI å·¥å…·
- **DBeaver**: é€šç”¨æ•°æ®åº“å·¥å…·
- **SQLite CLI**: å‘½ä»¤è¡Œå·¥å…·

### æ—¥å¿—åˆ†æ
- **Seq**: ç»“æ„åŒ–æ—¥å¿—æœåŠ¡å™¨
- **Serilog**: å·²é›†æˆ
- **grep/awk**: å‘½ä»¤è¡Œå·¥å…·

### æ€§èƒ½åˆ†æ
- **dotnet-trace**: æ€§èƒ½è·Ÿè¸ª
- **dotnet-counters**: æ€§èƒ½è®¡æ•°å™¨
- **Application Insights**: Azure ç›‘æ§

## 13. ä¸‹ä¸€æ­¥

ç°åœ¨æ‚¨å·²ç»æˆåŠŸè¿è¡Œäº† BlazorWebGame.Rebuild é¡¹ç›®ï¼Œå¯ä»¥ï¼š

1. âœ… æµè§ˆå’Œæµ‹è¯•æ‰€æœ‰ API ç«¯ç‚¹
2. âœ… ç ”ç©¶äº‹ä»¶ç³»ç»Ÿçš„å·¥ä½œåŸç†
3. âœ… äº†è§£æ•°æ®åº“ç»“æ„
4. âœ… å­¦ä¹ æœåŠ¡æ¶æ„è®¾è®¡
5. âœ… ä¿®æ”¹å’Œæ‰©å±•åŠŸèƒ½
6. âœ… åˆ›å»ºè‡ªå·±çš„å®ç°ç‰ˆæœ¬

## å‚è€ƒèµ„æº

- **é¡¹ç›®è¯´æ˜**: `README.md`
- **æ¶æ„å¯¹æ¯”**: `æ¶æ„å¯¹æ¯”è¯´æ˜.md`
- **æ€»ä½“è¯´æ˜**: `/BlazorWebGame.Rebuildé¡¹ç›®è¯´æ˜.md`
- **API æ–‡æ¡£**: https://localhost:7052/swagger
- **.NET æ–‡æ¡£**: https://docs.microsoft.com/dotnet
- **SignalR æ–‡æ¡£**: https://docs.microsoft.com/aspnet/core/signalr

---

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸš€
